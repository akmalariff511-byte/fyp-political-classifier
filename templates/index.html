<!DOCTYPE html>
<html>
<head>
  <title>FYP Political Classifier</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    textarea { width: 100%; max-width: 900px; }
    .box { background:#f5f5f5; padding:15px; border-radius:10px; max-width: 900px; }
    .row { margin: 8px 0; }
    .label { display:inline-block; width: 160px; font-weight: bold; }
    .badge { padding: 2px 8px; border-radius: 8px; background: #eaeaea; }
    pre { background:#111; color:#eee; padding:12px; border-radius:10px; max-width:900px; }
  </style>
</head>
<body>

<h1>Website is running ✅</h1>
<p>Test ayat di bawah (akan hantar ke <code>/predict</code>).</p>

<textarea id="textInput" rows="6">anwar terbaik</textarea>
<br><br>
<button onclick="sendText()">Predict</button>

<h2>Response</h2>

<div class="box">
  <div class="row"><span class="label">Political:</span> <span id="pLabel" class="badge">-</span> (<span id="pConf">-</span>)</div>
  <div class="row"><span class="label">Target:</span> <span id="tLabel" class="badge">-</span> (<span id="tConf">-</span>)</div>
  <div class="row"><span class="label">Hate:</span> <span id="hLabel" class="badge">-</span> (<span id="hConf">-</span>)</div>
  <div class="row"><span class="label">Emotion:</span> <span id="eLabel" class="badge">-</span> (<span id="eConf">-</span>)</div>
</div>

<h3>Raw JSON</h3>
<pre id="raw">{}</pre>

<script>
const EMOTION_LABELS = [
  "anger","anticipation","disgust","fear",
  "happy","sadness","surprise","trust"
];

// ✅ ikut mapping model training: 0..3
const TARGET_LABELS = [
  "no targeted","person","gov","political group"
];

function pct(x) {
  if (x === undefined || x === null || Number.isNaN(x)) return "-";
  return (x * 100).toFixed(2) + "%";
}

// helper: safe label
function safeText(x) {
  if (x === undefined || x === null) return "undefined";
  return String(x);
}

async function sendText() {
  const text = document.getElementById("textInput").value;

  const res = await fetch("/predict", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ text })
  });

  const data = await res.json();
  document.getElementById("raw").innerText = JSON.stringify(data, null, 2);

  // ----------------------------
  // MODE 1 (preferred):
  // expects:
  // political.prob, hate.prob
  // target.pred + target.probs[]
  // emotion.pred + emotion.probs[]
  // ----------------------------
  const hasProbs =
    (data?.political && typeof data.political.prob === "number") ||
    (data?.target && typeof data.target.pred === "number") ||
    (data?.emotion && typeof data.emotion.pred === "number");

  if (hasProbs) {
    // political
    const pProb = data.political?.prob;
    document.getElementById("pLabel").innerText = (pProb >= 0.5) ? "political" : "non-political";
    document.getElementById("pConf").innerText = pct(pProb);

    // hate
    const hProb = data.hate?.prob;
    document.getElementById("hLabel").innerText = (hProb >= 0.5) ? "hate" : "none";
    document.getElementById("hConf").innerText = pct(hProb);

    // target
    const t = data.target?.pred;
    document.getElementById("tLabel").innerText = (t !== undefined) ? TARGET_LABELS[t] : "undefined";
    document.getElementById("tConf").innerText = pct(data.target?.probs?.[t]);

    // emotion
    const e = data.emotion?.pred;
    document.getElementById("eLabel").innerText = (e !== undefined) ? EMOTION_LABELS[e] : "undefined";
    document.getElementById("eConf").innerText = pct(data.emotion?.probs?.[e]);

    return;
  }

  // ----------------------------
  // MODE 2 (fallback):
  // accepts simple strings:
  // { politic:"political", target:"person", hate:"none", emotion:"happy" }
  // OR { political:"political", target:"person", hate:"none", emotion:"happy" }
  // ----------------------------
  const polStr = data.politic ?? data.political;
  const tgtStr = data.target;
  const hateStr = data.hate;
  const emoStr = data.emotion;

  document.getElementById("pLabel").innerText = safeText(polStr);
  document.getElementById("pConf").innerText = "-";

  document.getElementById("tLabel").innerText = safeText(tgtStr);
  document.getElementById("tConf").innerText = "-";

  document.getElementById("hLabel").innerText = safeText(hateStr);
  document.getElementById("hConf").innerText = "-";

  document.getElementById("eLabel").innerText = safeText(emoStr);
  document.getElementById("eConf").innerText = "-";
}
</script>

</body>
</html>
