<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FYP Political Classifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0f1220;
  --card:#171a2e;
  --accent:#6cf2c2;
  --text:#f5f6fa;
  --muted:#a4a6c0;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Inter",system-ui,sans-serif;
  background:linear-gradient(135deg,#0f1220,#11142a);
  color:var(--text);
}

.container{
  max-width:1000px;
  margin:40px auto;
  padding:20px;
}

h1{font-size:2.2rem;margin-bottom:8px}
.sub{color:var(--muted);margin-bottom:30px}

textarea{
  width:100%;
  padding:14px;
  background:#0c0f1e;
  color:#fff;
  border:1px solid #2a2e55;
  border-radius:10px;
  resize:vertical;
  font-size:1rem;
}

button{
  margin-top:14px;
  padding:12px 26px;
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
  transition:.2s;
}
button:hover{transform:scale(1.05)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  margin-top:30px;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.card h3{
  margin:0 0 6px;
  font-size:1rem;
  color:var(--muted);
}

.value{
  font-size:1.4rem;
  font-weight:700;
}

.badge{
  display:inline-block;
  margin-top:6px;
  padding:4px 10px;
  border-radius:999px;
  font-size:.75rem;
  font-weight:600;
}

.green{background:#1dd1a1;color:#000}
.red{background:#ff6b6b;color:#000}
.blue{background:#54a0ff;color:#000}
.gray{background:#576574;color:#fff}

pre{
  margin-top:20px;
  background:#0b0e1a;
  padding:16px;
  border-radius:12px;
  overflow:auto;
  font-size:.85rem;
  display:none;
}

.toggle{
  margin-top:16px;
  color:var(--accent);
  cursor:pointer;
  font-weight:600;
}

.loading{
  opacity:.5;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="container">
  <h1>Political Text Intelligence System</h1>
  <div class="sub">Multitask XLM-R Model (Political • Target • Hate • Emotion)</div>

  <textarea id="text" rows="5">anwar terbaik</textarea>
  <br>
  <button onclick="predict()">Analyze</button>

  <div id="results" class="grid"></div>

  <div class="toggle" onclick="toggleRaw()">Show Raw JSON</div>
  <pre id="raw"></pre>
</div>

<script>
function badgeClass(v){
  if(v==="political"||v==="hate") return "red";
  if(v==="non-political"||v==="none") return "green";
  if(v==="person"||v==="gov") return "blue";
  return "gray";
}

function toggleRaw(){
  const r=document.getElementById("raw");
  r.style.display = (r.style.display==="none"||r.style.display==="") ? "block" : "none";
}

async function predict(){
  const text=document.getElementById("text").value;
  const container=document.querySelector(".container");
  container.classList.add("loading");

  let data = {};
  try{
    const res=await fetch("/predict",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({text})
    });

    // safer parsing (avoid "Expecting value..." when backend returns non-JSON)
    const rawText = await res.text();
    try { data = JSON.parse(rawText); }
    catch { data = { error: rawText || "Non-JSON response from server" }; }

  }catch(err){
    data = { error: String(err) };
  }finally{
    container.classList.remove("loading");
  }

  document.getElementById("raw").innerText=JSON.stringify(data,null,2);

  // Support BOTH formats:
  // (A) simple: { politic:"political", target:"person", hate:"none", emotion:"happy" }
  // (B) rich:   { politic:{label,score}, target:{label,id}, hate:{label,score}, emotion:{label,id} }
  const politicVal = data.politic ?? data.political;   // just in case
  const targetVal  = data.target;
  const hateVal    = data.hate;
  const emoVal     = data.emotion;

  const cards=[
    ["Political", politicVal?.label ?? politicVal ?? "-", politicVal?.score],
    ["Target",   targetVal?.label  ?? targetVal  ?? "-", null],
    ["Hate",     hateVal?.label    ?? hateVal    ?? "-", hateVal?.score],
    ["Emotion",  emoVal?.label     ?? emoVal     ?? "-", null],
  ];

  document.getElementById("results").innerHTML = cards.map(
    ([t,v,s])=>`
    <div class="card">
      <h3>${t}</h3>
      <div class="value">${v ?? "-"}</div>
      <span class="badge ${badgeClass(v)}">
        ${s!=null ? (s*100).toFixed(2)+"%" : "predicted"}
      </span>
    </div>`
  ).join("");
}
</script>
</body>
</html>
