<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FYP Political Classifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0f1220;
  --card:#171a2e;
  --accent:#6cf2c2;
  --text:#f5f6fa;
  --muted:#a4a6c0;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Inter",system-ui,sans-serif;
  background:linear-gradient(135deg,#0f1220,#11142a);
  color:var(--text);
}

.container{
  max-width:1000px;
  margin:40px auto;
  padding:20px;
}

h1{font-size:2.2rem;margin-bottom:8px}
.sub{color:var(--muted);margin-bottom:30px}

textarea{
  width:100%;
  padding:14px;
  background:#0c0f1e;
  color:#fff;
  border:1px solid #2a2e55;
  border-radius:10px;
  resize:vertical;
  font-size:1rem;
}

button{
  margin-top:14px;
  padding:12px 26px;
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
  transition:.2s;
}
button:hover{transform:scale(1.05)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  margin-top:30px;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.card h3{
  margin:0 0 6px;
  font-size:1rem;
  color:var(--muted);
}

.value{
  font-size:1.4rem;
  font-weight:700;
}

.badge{
  display:inline-block;
  margin-top:6px;
  padding:4px 10px;
  border-radius:999px;
  font-size:.75rem;
  font-weight:600;
}

.green{background:#1dd1a1;color:#000}
.red{background:#ff6b6b;color:#000}
.blue{background:#54a0ff;color:#000}
.gray{background:#576574;color:#fff}

pre{
  margin-top:20px;
  background:#0b0e1a;
  padding:16px;
  border-radius:12px;
  overflow:auto;
  font-size:.85rem;
  display:none;
}

.toggle{
  margin-top:16px;
  color:var(--accent);
  cursor:pointer;
  font-weight:600;
}

.loading{
  opacity:.5;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="container">
  <h1>Political Text Intelligence System</h1>
  <div class="sub">Multitask XLM-R Model (Political • Target • Hate • Emotion)</div>

  <textarea id="text" rows="5">anwar terbaik</textarea>
  <br>
  <button onclick="predict()">Analyze</button>

  <div id="results" class="grid"></div>

  <div class="toggle" onclick="toggleRaw()">Show Raw JSON</div>
  <pre id="raw"></pre>
</div>

<script>
// Label maps (ikut dataset kau)
const TARGET_LABELS = ["no targeted", "person", "gov", "political group"];
const EMO_LABELS = ["anger","anticipation","disgust","fear","happy","sadness","surprise","trust"];

function pct(x){
  return (x*100).toFixed(2) + "%";
}

function badgeClass(v){
  if(v==="political"||v==="hate") return "red";
  if(v==="non-political"||v==="non-hate"||v==="none") return "green";
  if(v==="person"||v==="gov"||v==="political group") return "blue";
  return "gray";
}

function toggleRaw(){
  const r=document.getElementById("raw");
  r.style.display = (r.style.display==="none"||r.style.display==="") ? "block" : "none";
}

async function predict(){
  const text=document.getElementById("text").value;
  const container=document.querySelector(".container");
  container.classList.add("loading");

  let data = {};
  try{
    const res=await fetch("/predict",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({text})
    });

    const rawText = await res.text();
    try { data = JSON.parse(rawText); }
    catch { data = { error: rawText || "Non-JSON response from server" }; }

  }catch(err){
    data = { error: String(err) };
  }finally{
    container.classList.remove("loading");
  }

  // show raw json
  document.getElementById("raw").innerText=JSON.stringify(data,null,2);

  // if error
  if(data && data.error){
    document.getElementById("results").innerHTML = `
      <div class="card" style="grid-column:1/-1">
        <h3>Error</h3>
        <div class="value">${String(data.error)}</div>
        <span class="badge gray">check server / tunnel</span>
      </div>`;
    return;
  }

  // ---- Parse response (ikut server kau) ----
  const polProb  = data?.political?.prob;
  const hateProb = data?.hate?.prob;

  const tgtPred  = data?.target?.pred;
  const tgtProb  = (tgtPred != null && data?.target?.probs)
    ? data.target.probs[tgtPred]
    : null;

  const emoPred  = data?.emotion?.pred;
  const emoProb  = (emoPred != null && data?.emotion?.probs)
    ? data.emotion.probs[emoPred]
    : null;

  const polLabel  = (polProb != null)  ? (polProb >= 0.5 ? "political" : "non-political") : "-";
  const hateLabel = (hateProb != null) ? (hateProb >= 0.5 ? "hate" : "non-hate") : "-";
  const tgtLabel  = (tgtPred != null)  ? (TARGET_LABELS[tgtPred] ?? ("id:"+tgtPred)) : "-";
  const emoLabel  = (emoPred != null)  ? (EMO_LABELS[emoPred] ?? ("id:"+emoPred)) : "-";

  const cards = [
    ["Political", polLabel,  polProb  != null ? pct(polProb)  : null],
    ["Target",    tgtLabel,  tgtProb  != null ? pct(tgtProb)  : null],
    ["Hate",      hateLabel, hateProb != null ? pct(hateProb) : null],
    ["Emotion",   emoLabel,  emoProb  != null ? pct(emoProb)  : null],
  ];

  document.getElementById("results").innerHTML = cards.map(
    ([t,v,p])=>`
    <div class="card">
      <h3>${t}</h3>
      <div class="value">${v}</div>
      <span class="badge ${badgeClass(v)}">
        ${p ?? "predicted"}
      </span>
    </div>`
  ).join("");
}
</script>
</body>
</html>
